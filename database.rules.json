{
  "rules": {
    "users": {
      "$userId": {
        ".read": "$userId === auth.uid",
        ".write": "$userId === auth.uid",
        "jiraConfig": {
          ".validate": "newData.hasChildren(['cloudId', 'accessToken', 'refreshToken', 'site', 'expiresAt', 'storyPointsFieldId', 'connectedAt'])",
          "cloudId": {
            ".validate": "newData.isString() && newData.val().length > 0"
          },
          "accessToken": {
            ".validate": "newData.isString() && newData.val().length > 0"
          },
          "refreshToken": {
            ".validate": "newData.isString() && newData.val().length > 0"
          },
          "site": {
            ".validate": "newData.isString() && newData.val().length > 0"
          },
          "expiresAt": {
            ".validate": "newData.isNumber()"
          },
          "storyPointsFieldId": {
            ".validate": "newData.isString()"
          },
          "connectedAt": {
            ".validate": "newData.isString()"
          },
          "lastSyncedAt": {
            ".validate": "newData.isString()"
          }
        }
      }
    },
    "pokerTables": {
      "$ownerId": {
        ".read": "auth != null",
        "$tableId": {
          ".write": "auth != null",
          "created": {
            ".validate": "newData.isString() && newData.val().length > 0 && $ownerId === auth.uid"
          },
          "tableName": {
            ".validate": "newData.isString() && newData.val().length > 0 && newData.val().length <= 100 && $ownerId === auth.uid"
          },
          "ownerId": {
            ".validate": "newData.val() === $ownerId && $ownerId === auth.uid"
          },
          "ownerName": {
            ".validate": "newData.isString() && newData.val().length > 0 && newData.val().length <= 100 && $ownerId === auth.uid"
          },
          "lastEdited": {
            ".validate": "newData.isString()"
          },
          "lastEditedBy": {
            ".validate": "newData.isString()"
          },
          "lastEditedByName": {
            ".validate": "newData.isString() && newData.val().length <= 100"
          },
          "currentIssue": {
            ".validate": "newData.isString() || newData.isBoolean()"
          },
          "issues": {
            "$issueId": {
              ".validate": "newData.hasChildren(['title', 'created'])",
              "title": {
                ".validate": "newData.isString() && newData.val().length > 0 && newData.val().length <= 200"
              },
              "created": {
                ".validate": "newData.isString()"
              },
              "isLocked": {
                ".validate": "newData.isBoolean()"
              },
              "showVotes": {
                ".validate": "newData.isBoolean()"
              },
              "finalScore": {
                ".validate": "newData.isNumber() || newData.val() === null"
              },
              "lastEdited": {
                ".validate": "newData.isString()"
              },
              "lastEditedBy": {
                ".validate": "newData.isString()"
              },
              "lastEditedByName": {
                ".validate": "newData.isString() && newData.val().length <= 100"
              },
              "jiraKey": {
                ".validate": "newData.isString() && newData.val().length > 0"
              },
              "jiraId": {
                ".validate": "newData.isString() && newData.val().length > 0"
              },
              "jiraUrl": {
                ".validate": "newData.isString() && newData.val().length > 0"
              },
              "$other": {
                ".validate": false
              }
            }
          },
          "participants": {
            "$participantId": {
              ".read": "auth != null",
              ".write": "$participantId === auth.uid",
              ".validate": "newData.hasChildren(['uid', 'displayName', 'joinedAt', 'isHost', 'role'])",
              "uid": {
                ".validate": "newData.val() === $participantId"
              },
              "displayName": {
                ".validate": "newData.isString() && newData.val().length > 0 && newData.val().length <= 100"
              },
              "joinedAt": {
                ".validate": "newData.isString()"
              },
              "isHost": {
                ".validate": "newData.isBoolean()"
              },
              "role": {
                ".validate": "newData.val() === 'voter' || newData.val() === 'spectator'"
              },
              "$other": {
                ".validate": false
              }
            }
          },
          "$other": {
            ".validate": false
          }
        }
      }
    },
    "votes": {
      "$tableIssueId": {
        ".read": "auth != null",
        "$userId": {
          ".write": "$userId === auth.uid",
          ".validate": "newData.hasChildren(['vote'])",
          "vote": {
            ".validate": "(newData.isNumber() && newData.val() >= 0) || newData.val() === null"
          },
          "$other": {
            ".validate": false
          }
        }
      }
    }
  }
}
